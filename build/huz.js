!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return o.map(function(t){return new t(e)})}function a(e){return o.push(e)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.instantiateAll=r,t.register=a;var o=[],l=function(){function e(){i(this,e)}return s(e,[{key:"transformToken",value:function(e){return e}},{key:"handleToken",value:function(e,t){}},{key:"visit",value:function(e){return e}},{key:"handleNode",value:function(e,t){}},{key:"transformNodeResult",value:function(e,t,n){return n}},{key:"transformResult",value:function(e){return e}}]),e}();t.Extension=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EOF="EOF";t.TEXT="TEXT";t.PARTIAL="PARTIAL";t.INVERTED_SECTION_OPEN="INVERTED_SECTION_OPEN";t.SECTION_OPEN="SECTION_OPEN";t.SECTION_CLOSE="SECTION_CLOSE";t.UNESCAPED_VARIABLE="UNESCAPED_VARIABLE";t.COMMENT="COMMENT";t.VARIABLE="VARIABLE";t.DELIMITER_CHANGE="DELIMITER_CHANGE"},function(e,t,n){"use strict";function i(e,t){for(var n=e.children.slice(0).reverse();n.length;){var i=n.pop();t(i),void 0!==i.children&&(n=n.concat(i.children.slice(0).reverse()))}}function r(e,t){for(var n=[e];n.length;)for(var i=n.pop(),r=0;r<i.children.length;r++){var a=i.children[r],s=t.visit(a)||a;s!==a&&(i.children[r]=s),a.children&&a.children.length&&n.push(a)}}function a(e){var t=e.length;if(0===t)return e;for(var n=null,i=0,r=!0,a=[],o=0;r&&o<t;o++){var c=e[o];switch(c.type){case l.VARIABLE:case l.UNESCAPED_VARIABLE:r=!1;break;case l.TEXT:s(c.text)?0===i&&a.push(c):r=!1;break;case l.DELIMITER_CHANGE:case l.COMMENT:null!==n?n.push(c):i++;break;case l.SECTION_CLOSE:n?n[0].name===c.name?n=null:r=!1:i++;break;default:null===n?(n=[c],i++):r=!1}i>1&&(r=!1)}if(n&&n.length>1&&(r=!1),r){if(a.length===t)return e;for(var h=0,o=t-1;o>=0;o--){var c=e[o];if(c.type!=l.TEXT||!s(c.text))break;h++}if((a.length>0||h>0)&&(e=e.slice(a.length,t-h),a.length)){var u="";a.forEach(function(e){u+=e.text}),e[0].indent=u}}return e}function s(e){return/^\s*$/.test(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.walk=i,t.visit=r,t.trimStandaloneToken=a;var o=n(1),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ROOT="ROOT";t.VARIABLE="VARIABLE";t.SECTION="SECTION";t.TEXT="TEXT";t.COMMENT="COMMENT";t.PARTIAL="PARTIAL";t.DELIMITER_CHANGE="DELIMITER_CHANGE"},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(1),o=i(s),l=n(3),c=i(l),h=n(5),u=(n(2),n(0)),_=function(){function e(t){r(this,e),this._parser=t}return a(e,[{key:"appendNode",value:function(e){this._parser._appendNode(e)}},{key:"pushParent",value:function(e){this._parser._pushParent(e)}},{key:"popParent",value:function(){return this._parser._popParent()}},{key:"findParentNode",value:function(e){for(var t=this._parser._stack.length-1;t>=0;t--){var n=this._parser._stack[t];if(e(n))return n}return null}},{key:"throw",value:function(e,t){return this._parser._throw(e,t)}},{key:"filename",get:function(){return this._parser._filename}},{key:"top",get:function(){return this._parser._stack.length}},{key:"parentNode",get:function(){return this._parser._stack.length>0?this._parser._stack[this._parser._stack.length-1]:null}},{key:"tailNode",get:function(){return this.parentNode}},{key:"src",get:function(){return this._parser._src}}]),e}(),f=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];r(this,e),this._delimiters=t.delimiters?t.delimiters:["{{","}}"],this._extensions=t.extensions||(0,u.instantiateAll)(t),this._filename=t.filename||"",this._extensions.length>0&&(this._parserContext=new _(this)),this._stack=null,this._lastToken=null,this._src=null}return a(e,[{key:"parse",value:function(e){var t={type:c.ROOT,children:[]};if(this._src=e,this._stack=[t],this._lastToken=null,this._parseNodes(e),this._extensions.length>0)for(var n=0;n<this._extensions.length;n++)this._extensions[n].visit(t);return t}},{key:"_addNodeToken",value:function(e){var t=this._lastToken;e.tokens?e.tokens.push(t):e.tokens=[t]}},{key:"_appendNode",value:function(e){return this._addNodeToken(e),e.location.filename=this._filename,this._stack[this._stack.length-1].children.push(e),e}},{key:"_getTop",value:function(){return this._stack[this._stack.length-1]}},{key:"_clone",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"_makeLocation",value:function(e,t){var n=this._clone(e);return t&&(n.endIndex=t.endIndex,n.endLine=t.endLine),n}},{key:"_parseNodes",value:function(e){var t=this._stack.length,n=void 0,i=new h.Tokenizer(e,{delimiters:this._delimiters.slice(0),extensions:this._extensions,filename:this._filename});do{if(n=i.getNextToken(),null!==i.error)throw i.error;this._lastToken=n;var r=!1;if(this._extensions)for(var a=0;a<this._extensions.length;a++){var s=this._extensions[a];if(!0===s.handleToken(n,this._parserContext)){r=!0;break}}if(!r)switch(n.type){case o.TEXT:this._appendNode({type:c.TEXT,text:n.text,location:this._makeLocation(n.location)});break;case o.VARIABLE:case o.UNESCAPED_VARIABLE:this._appendNode({type:c.VARIABLE,name:n.name,unescaped:n.type===o.UNESCAPED_VARIABLE,location:this._makeLocation(n.location)});break;case o.SECTION_OPEN:this._handleSectionOpen(n);break;case o.INVERTED_SECTION_OPEN:this._handleSectionOpen(n,!0);break;case o.SECTION_CLOSE:this._handleSectionClose(n);break;case o.PARTIAL:this._appendNode({type:c.PARTIAL,name:n.name,indent:n.indent,location:this._makeLocation(n.location)});break;case o.COMMENT:this._handleComment(n);break;case o.DELIMITER_CHANGE:this._appendNode({type:c.DELIMITER_CHANGE,delimiters:n.delimiters,location:this._makeLocation(n.location)})}}while(n.type!==o.EOF);this._stack.length>t?this._throw("Unexpected EOF: sections not closed: "+this._stack.slice(t).map(function(e){return"'"+e.name+"'"}).join(", ")):this._stack.length<t&&this._throw("Internal error.")}},{key:"_throw",value:function(e,t){t=t||this._lastToken.location;var n=new Error(e);throw n.filename=t.filename,n.location=t,n}},{key:"_pushParent",value:function(e){this._addNodeToken(e),e.children=[],this._stack.push(e)}},{key:"_popParent",value:function(){return this._stack.pop()}},{key:"_handleSectionOpen",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=e.name,i=e.location;this._pushParent({type:c.SECTION,name:n,inverted:t,location:i})}},{key:"_handleSectionClose",value:function(e){var t=e.name,n=e.location,i=this._popParent();i.type!==c.SECTION&&this._throw("Unexpected SECTION_CLOSE: '"+t+"'"),i.name!==t&&this._throw("Unexpected SECTION_CLOSE: '"+t+"', current section: '"+i.name+"'"),i.raw=this._src.slice(i.location.endIndex,n.index),i.location=this._makeLocation(i.location,e.location),this._appendNode(i)}},{key:"_handleComment",value:function(e){var t=e.content,n=e.location;this._appendNode({type:c.COMMENT,content:t,location:this._makeLocation(n)})}}]),e}();t.Parser=f},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){var t=e.match(f);return t?t.slice(1):null}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(1),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),c=n(0),h=n(2),u="STATE_NONE",_=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this._extensions=n.extensions||(0,c.instantiateAll)(),this._src=t,this._index=0,this._char=null,this._tokens=[],this._line=1,this._column=1,this._state=u,this._error=null,this._filename=n.filename,this._location={index:0,line:0,column:0},this._delimiters=n.delimiters?n.delimiters:["{{","}}"]}return s(e,[{key:"getNextToken",value:function(){if(this._tokens.length>0)return this._tokens.shift();var e=!1,t=!1;do{if(null!==this._error)return null;switch(this._state!==u&&(t=!0,this._markTokenStartLocation()),this._state){case u:this._read();break;case"STATE_EOF":this._handleEOF(),e=!0;break;case"STATE_TEXT":this._handleText();break;case"STATE_TEXT_BREAK":this._handleTextBreak(),e=!0;break;case"STATE_TAG":this._handleTag()}t&&!this._error&&(this._markTokenEndLocation(),t=!1),this._state===u&&(null===this._char?this._state="STATE_EOF":"\n"===this._char?this._state="STATE_TEXT_BREAK":this._isDelimiter(0)?this._state="STATE_TAG":this._state="STATE_TEXT")}while(!e);return null===this._error?this._tokens.shift():null}},{key:"_handleEOF",value:function(){this._handleStandaloneTag(),this._makeToken({type:l.EOF})}},{key:"_handleTag",value:function(){var e=a(this._delimiters,2),t=e[0],n=e[1];if(this._skip(t.length),this._skipAllWhitespaces(),null===this._char)this._setError("Unclosed tag.");else if(this._isDelimiter(1))this._handleEmptyTag();else{var i=this._char;if("{"===i)this._handleVariableCurly();else{for(var r=this._index-1;!this._isDelimiter(1)&&null!==this._char;)this._read();if(null===this._char)this._setError("Unclosed tag.");else{var s=this._src.slice(r,this._index-1);switch(i){case">":this._handleSimpleTag(l.PARTIAL,s);break;case"^":this._handleSimpleTag(l.INVERTED_SECTION_OPEN,s);break;case"#":this._handleSimpleTag(l.SECTION_OPEN,s);break;case"/":this._handleSimpleTag(l.SECTION_CLOSE,s);break;case"!":this._handleComment(s.substr(1));break;case"=":this._handleDelimiterChange(s);break;case"&":this._handleVariable(s.substr(1),!0);break;default:this._handleVariable(s)}}}}if(null===this._error)for(var o=0;o<n.length;o++)this._read();this._state=u}},{key:"_handleDelimiterChange",value:function(e){var t=r(e);if(null===t)this._setError("Invalid change delimiter syntax.");else{var n=a(t,2),i=n[0],s=n[1];this._delimiters=t,this._makeToken({type:l.DELIMITER_CHANGE,delimiters:[i,s]})}}},{key:"_handleSimpleTag",value:function(e,t){this._makeToken({type:e,name:t.substr(1).trim()})}},{key:"_handleComment",value:function(e){this._makeToken({type:l.COMMENT,content:e})}},{key:"_handleVariableCurly",value:function(){this._read();var e=this._index-1,t=this._distance("}");if(-1===t)this._setError("Unclosed variable tag: missingright curly.");else{var n=this._src.slice(e,e+t);this._skip(t+1),this._skipAllWhitespaces(),this._isDelimiter(1)?this._makeToken({type:l.UNESCAPED_VARIABLE,name:n.trim()}):this._setError("Unclosed variable: missing right delimiter.")}}},{key:"_handleEmptyTag",value:function(){this._makeToken({type:l.VARIABLE,name:""})}},{key:"_handleVariable",value:function(e,t){this._makeToken({type:t?l.UNESCAPED_VARIABLE:l.VARIABLE,name:e.trim()})}},{key:"_handleText",value:function(){var e=!1,t=this._index-1,n=0;do{var i=this._char;null===i||"\n"===i||this._isDelimiter(0)?e=!0:n++,e||this._read()}while(!e);this._makeToken({type:l.TEXT,text:this._src.slice(t,t+n)}),this._state=u}},{key:"_handleTextBreak",value:function(){this._makeToken({type:l.TEXT,text:"\n"}),this._read(),this._handleStandaloneTag(),this._state=u}},{key:"_handleStandaloneTag",value:function(){this._tokens=(0,h.trimStandaloneToken)(this._tokens)}},{key:"_dump",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];console.log(e+">"+this._src.slice(this._index-1))}},{key:"_read",value:function(){this._index<this._src.length?("\n"===this._char?(this._line++,this._column=0):this._column++,this._char=this._src[this._index],this._index++):this._char=null}},{key:"_peek",value:function(){return this._index<this._src.length-1?this._src[this._index]:null}},{key:"_skip",value:function(e){for(var t=0;t<e;t++)this._read()}},{key:"_distance",value:function(e){for(var t=this._index;t<this._src.length;t++)if(this._src[t]===e)return t-this._index+1;return-1}},{key:"_skipAllWhitespaces",value:function(){for(;this._isWhitespace();)this._read()}},{key:"_markTokenStartLocation",value:function(){this._location.index=this._index-1,this._location.line=this._line,this._location.column=this._column}},{key:"_markTokenEndLocation",value:function(){var e=this._tokens[this._tokens.length-1];e.location.endIndex=this._index-1,e.location.endLine=this._line,e.location.endColumn=this._column}},{key:"_isWhitespace",value:function(){return/\s/.test(this._char)}},{key:"_isDelimiter",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=this._delimiters[e],i=this._index-1+t;return this._src.slice(i,i+n.length)===n}},{key:"_makeToken",value:function(e){e.filename=this._filename;var t=this._location,n=t.index,i=t.line,r=t.column;if(e.location={filename:this._filename,index:n,line:i,column:r},this._extensions.length)try{this._extensions.forEach(function(t){e=t.transformToken(e)})}catch(e){return void this._setError(e.message)}this._tokens.push(e)}},{key:"_setError",value:function(e){var t=new Error(e);t.filename=this._filename,t.index=this._index-1,t.line=this._line,t.column=this._column,this._error=t}},{key:"error",get:function(){return this._error}}]),e}();t.Tokenizer=_;var f=/=[\s\n]*([^\s\n]*?)[\s\n]+([^\s\n]*?)[\s\n]*=[\s\n]*$/},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return e===p||e===d}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e,t,n){for(var i=!0;i;){var r=e,a=t,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var l=o.get;if(void 0===l)return;return l.call(s)}var c=Object.getPrototypeOf(r);if(null===c)return;e=c,t=a,n=s,i=!0,o=c=void 0}},c=n(0),h=n(3),u=i(h),_=n(1),f=i(_),p="Inheritance.PARENT",d="Inheritance.BLOCK",k=function(e){function t(){r(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._blocks=null,this._parentStack=[]}return a(t,e),o(t,[{key:"transformToken",value:function(e){var t=e,n=t.type,i=t.name,r=t.location;switch(n){case f.VARIABLE:if(i)if("<"===i[0]){if(1===i.length)throw new Error("Parent partial name expected");e={type:p,name:i.slice(1),location:r}}else if("$"===i[0]){if(1===i.length)throw new Error("Block name expected");e={type:d,name:i.slice(1),location:r}}}return e}},{key:"handleToken",value:function(e,t){var n=!1,i=e.name,r=e.location;switch(e.type){case p:t.pushParent({type:p,name:i,location:r}),n=!0;break;case d:this._pushBlock({type:d,name:i,location:r},t);break;case f.SECTION_CLOSE:var a=t.parentNode;if(s(a.type)&&a.name!==i&&t.throw("Unexpected tag close '"+i+"', current tag: '"+a.name+"'"),s(a.type)){t.popParent(),a.location.endIndex=r.endIndex,a.location.endLine=r.endLine,t.appendNode(a);var o=a.location.line,l=a.children.find(function(e){return e.type===d});if(l&&l.location.line===o)for(var c=0;c<l.children.length;c++){var h=l.children[c];if(h.type!==u.TEXT||!/^\s*$/.test(h.text))break;h.text=""}n=!0}}return n}},{key:"handleNode",value:function(e,t){var n=t.top;switch(this._checkTop(n),e.type){case p:return this._handleParent(e,t),!0;case d:return this._handleBlock(e,t),!0;case"Inheritance.LEAVE_SCOPE":return this._blocks=null,!0}}},{key:"_pushBlock",value:function(e,t){t.findParentNode(function(t){return t.type===d&&t.name===e.name})&&t.throw("Recursive block: '"+e.name+"'"),t.pushParent(e)}},{key:"_handleParent",value:function(e,t){var n=e.name,i=e.location,r=t.top;this._pushParent(n,r),null===this._blocks&&(t.pushNodes([{type:"Inheritance.LEAVE_SCOPE"}]),this._blocks={});var a={};e.children.forEach(function(e){if(e.type===d){var t=e.name;a[t]=e}}),Object.keys(a).length&&this._setDefaultBlocks(a),t.pushNode({type:f.PARTIAL,name:n,location:i,indent:e.indent})}},{key:"_handleBlock",value:function(e,t){var n=e.name,i=this._getDefaultBlock(n);i?t.pushNodes(i.children):t.pushNodes(e.children)}},{key:"_pushParent",value:function(e,t){return this._parentStack.push({name:e,blocks:{},top:t})}},{key:"_checkTop",value:function(e){for(var t=0,n=this._parentStack.length-1;n>=0;n--){if(!(this._parentStack[n].top>e))break;t++}t>0&&(this._parentStack=this._parentStack.slice(0,this._parentStack.length-t))}},{key:"_popParent",value:function(){return this._parentStack.pop()}},{key:"_getDefaultBlock",value:function(e){for(var t=0;t<this._parentStack.length;t++){var n=this._parentStack[t];if(e in n.blocks)return n.blocks[e]}return null}},{key:"_setDefaultBlocks",value:function(e){var t=this._parentStack[this._parentStack.length-1];t.blocks=Object.assign(t.blocks,e)}}]),t}(c.Extension);t.Inheritance=k},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return"[object Function]"==Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(3),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),l=n(9),c=function(e){return e&&e.__esModule?e:{default:e}}(l),h=n(4),u=n(2),_=n(0),f=function(){function e(t){i(this,e),this._renderer=t}return a(e,[{key:"evaluate",value:function(e){return this._renderer._evaluate(e)}},{key:"pushNodes",value:function(e){this._renderer._pushNodes(e)}},{key:"pushNode",value:function(e){this._renderer._pushNode(e)}},{key:"pushContext",value:function(e,t){this._renderer._pushContext(e,t)}},{key:"appendText",value:function(e){this._renderer._out+=e}},{key:"parse",value:function(e,t){return this._renderer._parse(e,t)}},{key:"getParsedPartial",value:function(e){return this._renderer._getParsedPartial(e)}},{key:"throw",value:function(e,t){return this._renderer._throw(e,t)}},{key:"top",get:function(){return this._renderer._stack.length}},{key:"result",get:function(){return this._renderer._out}}]),e}(),p=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this._parsed=r.parsed||!1,this._filename=r.filename,this._partials=r.partials||{},this._delimiters=r.delimiters?r.delimiters:["{{","}}"],this._extensions=r.extensions||(0,_.instantiateAll)(r),this._extensions.length>0&&(this._renderContext=new f(this)),this._partialCached={},this._parsed&&Object.keys(this._partials).forEach(function(e){n._partialCached[e]=n._partials[e].children}),this._stack=null,this._contextStack=null,this._partialStack=null,this._lambdaStack=null,this._src=t,this._out="",this._transformNodeResult=function(e,t,i){return n._extensions.reduce(function(n,i){return i.transformNodeResult(e,t,n)},i)}}return a(e,[{key:"render",value:function(e){var t=this;this._out="",this._stack=[],this._contextStack=[],this._partialStack=[],this._lambdaStack=[],this._pushContext(e);var n=this._parsed?this._src:this._parse(this._src,{filename:this._filename});this._stack=n.children.slice(0).reverse();for(var i=0,a=!0;this._stack.length>0;)!function(){var e=t._stack.length-1,n=t._stack[e];n.type!==o.TEXT&&++i>3e3&&t._throw("Possible infinity loop detected: last node type is '"+n.type+"'",n.location);var s=!1;if(t._extensions&&t._extensions.forEach(function(e){e.handleNode(n,t._renderContext)&&(s=!0)}),s)t._stack.splice(e,1);else{var l=t._partialStack.length?t._partialStack[t._partialStack.length-1]:null;n.type in o&&a&&null!==l&&l.indent.length>0&&(t._out+=l.indent);var h=void 0;switch(n.type){case o.VARIABLE:if(h=t._evaluate(n.name),r(h))t._popNode(),t._expandLambda(n,h);else{if(h){var u=n.unescaped?h:(0,c.default)(h);t._out+=t._transformNodeResult(n,t._out,u)}t._popNode()}break;case o.SECTION:if(h=t._evaluate(n.name),r(h))t._popNode(),t._expandLambda(n,h);else{var _=Array.isArray(h);_&&0===h.length&&(h=!1,_=!1);var f=!!h;n.inverted&&(f=!f),f?_?(t._popNode(),t._pushRepeaterNode(h.length,n.children,h)):(t._popNode(),t._pushContext(h),t._pushNodes(n.children)):t._popNode()}break;case o.TEXT:t._out+=t._transformNodeResult(n,t._out,n.text),t._popNode();break;case o.COMMENT:t._popNode();break;case o.PARTIAL:t._popNode(),t._expandPartial(n);break;case o.DELIMITER_CHANGE:t._popNode(),t._delimiters=n.delimiters.slice(0);break;case"_REPEATER":if(n.count<n.repeat){var p=n.count;0===p?n.contextIndex=t._pushContext(n.contexts[0]):t._replaceContextAt(n.contextIndex,n.contexts[p]),t._pushNodes(n.children),n.count++}else t._popNode();break;default:t._popNode()}}t._checkStacks(),a=0===t._out.length||"\n"===t._out[t._out.length-1]}();return this._extensions.reduce(function(e,t){return t.transformResult(e)},this._out)}},{key:"_parse",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t.extensions=this._extensions,new h.Parser(t).parse(e)}},{key:"_pushNodes",value:function(e){for(var t=e.length-1;t>=0;t--)this._stack.push(e[t])}},{key:"_pushNode",value:function(e){this._stack.push(e)}},{key:"_popNode",value:function(){this._stack.pop()}},{key:"_pushRepeaterNode",value:function(e,t,n){this._stack.push({type:"_REPEATER",count:0,repeat:e,children:t.slice(0),contexts:n})}},{key:"_pushContext",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this._stack.length:arguments[1];return this._contextStack.length&&(t=Math.min(Math.max(this._contextStack[this._contextStack.length-1].sp,t),this._stack.length)),this._contextStack.push({context:e,sp:t})-1}},{key:"_replaceContextAt",value:function(e,t){if(e<0||e>this._contextStack.length-1)throw new RangeError("Huz context index out of range.");this._contextStack[e].context=t}},{key:"_pushPartial",value:function(e){var t=e.name,n=e.indent,i=e.location;this._partialStack.push({name:t,indent:n||"",location:i,sp:this._stack.length})}},{key:"_pushLambda",value:function(e){var t=e.name,n=e.location;this._lambdaStack.push({name:t,location:n,sp:this._stack.length})}},{key:"_checkStacks",value:function(){for(;this._stack.length<this._contextStack[this._contextStack.length-1].sp;)this._contextStack.pop();this._partialStack.length>0&&this._stack.length===this._partialStack[this._partialStack.length-1].sp&&this._partialStack.pop(),this._lambdaStack.length>0&&this._stack.length===this._lambdaStack[this._lambdaStack.length-1].sp&&this._lambdaStack.pop()}},{key:"_evaluate",value:function(e){if("."===e)return this._contextStack[this._contextStack.length-1].context;for(var t=e.split("."),n=this._contextStack.length-1;n>=0;n--){var i=this._contextStack[n].context;if(null!==i&&"object"==typeof i){for(var r=i,a=!0,s=0;s<t.length;s++){var o=t[s];if("object"!=typeof r||null===r||!r.hasOwnProperty(o)){a=!1;break}r=r[o]}if(a)return r}}return""}},{key:"_getParsedPartial",value:function(e){if(this._partialCached.hasOwnProperty(e))return this._partialCached[e];if(!this._partials.hasOwnProperty(e))return null;var t=this._parse(this._partials[e],{filename:e});return this._partialCached[e]=t.children}},{key:"_expandPartial",value:function(e){var t=e.name,n=this._getParsedPartial(t);null!==n&&(this._pushPartial(e),this._partialStack.length>10&&this._throw("Possible partial short circuit: "+this._partialStack.map(function(e){return e.name+"@"+e.location.filename+":"+(e.location.line+1)}).concat([t]).join(" -> "),e.location),this._pushNodes(n))}},{key:"_expandLambda",value:function(e,t){var n=e.name;this._pushLambda(e),this._lambdaStack.length>255&&this._throw("Possible lambda short circuit: "+this._lambdaStack.map(function(e){return e.name+"@"+e.location.filename+":"+(e.location.line+1)}).concat([n]).join(" -> "),e.location);var i=void 0,r=!1;if(e.type===o.VARIABLE){var a=t();a?(i=this._parse(""+a,{filename:"[lambda]"}),e.unescaped||(0,u.walk)(i,function(e){e.type===o.TEXT&&(e.text=(0,c.default)(e.text))})):r=!0}else if(e.type===o.SECTION){var a=t(e.raw);a?i=this._parse(""+a,{filename:"[#lambda]",delimiters:this._delimiters.slice(0)}):r=!0}r||this._pushNodes(i.children)}},{key:"_throw",value:function(e,t){var n=new Error(e);throw n.filename=t.filename,n.location=t,n}}]),e}();t.Renderer=p},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){return new o.Parser(t).parse(e)}function a(e,t){return new l.Renderer(e,t)}function s(e,t,n){return a(e,n).render(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=r,t.compile=a,t.render=s;var o=n(4),l=n(7),c=n(1),h=i(c),u=n(3),_=i(u),f=n(2),p=i(f),d=n(0),k=n(6),v=n(5);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return v.Tokenizer}}),t.Parser=o.Parser,t.Renderer=l.Renderer,t.TokenType=h,t.NodeType=_,Object.defineProperty(t,"Extension",{enumerable:!0,get:function(){return d.Extension}}),(0,d.register)(k.Inheritance),t.register=d.register,t.Helpers=p},function(e,t,n){"use strict";function i(e){var t=""+e,n=r.exec(t);if(!n)return t;var i,a="",s=0,o=0;for(s=n.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 39:i="&#39;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}o!==s&&(a+=t.substring(o,s)),o=s+1,a+=i}return o!==s?a+t.substring(o,s):a}/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */
var r=/["'&<>]/;e.exports=i}])});
//# sourceMappingURL=huz.js.map